<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lightning Horn Unicorn</title>
    
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' https://unpkg.com; 
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
        font-src 'self' https://fonts.gstatic.com; 
        img-src 'self' data: blob:; 
        connect-src 'self' https://raw.githubusercontent.com https://unpkg.com blob:; 
        media-src 'self' https://raw.githubusercontent.com;
    ">

    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

    <style>
        body { margin: 0; overflow: hidden; background-color: #000814; font-family: system-ui, sans-serif; }
        #matrix-bg { position: fixed; inset: 0; width: 100%; height: 100%; z-index: 0; display: block; }
        #container3D { position: relative; width: 100%; height: 100vh; z-index: 1; }
        #ui-wrapper { position: absolute; top: 16px; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; gap: 10px; z-index: 9999; }
        #ui-wrapper button {
            position: relative; padding: 10px 20px; font-size: 11px; border-radius: 999px; border: 1px solid rgba(0, 255, 255, 0.7);
            background: radial-gradient(circle at 0% 0%, rgba(0,255,255,0.25), transparent 60%) rgba(10, 20, 40, 0.65);
            cursor: pointer; font-family: "Press Start 2P", system-ui, sans-serif; text-transform: uppercase;
            color: #e6faff; box-shadow: 0 0 8px rgba(0, 255, 255, 0.55); backdrop-filter: blur(6px);
        }
    </style>
</head>

<body>
    <canvas id="matrix-bg"></canvas>
    <div id="container3D"></div>

    <div id="ui-wrapper">
        <button id="music-toggle" data-lang-en="MUSIC OFF" data-lang-de="MUSIK AUS" data-lang-fr="MUSIQUE ÉTEINTE">MUSIC OFF</button>
        <button id="navigate-to-main" data-lang-en="GO TO MAIN PAGE" data-lang-de="ZUR HAUPTSEITE" data-lang-fr="ALLER À LA PAGE PRINCIPALE">GO TO MAIN PAGE</button>
    </div>

    <audio id="background-music" loop>
        <source src="https://raw.githubusercontent.com/erocshgih/lightninghornunicorn/main/intro.mp3" type="audio/mpeg" />
    </audio>

    <script>
        /* MATRIX LOGIC */
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');
        let sevens = [];
        let centerX, centerY;
        function resize() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            centerX = canvas.width / 2; centerY = canvas.height / 2;
            sevens = Array.from({length: 140}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, life: Math.random(), speed: 0.01 }));
        }
        function draw() {
            ctx.fillStyle = 'rgba(0, 5, 40, 0.35)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            sevens.forEach(s => {
                s.life += s.speed; if (s.life >= 1) s.life = 0;
                ctx.font = (26 * (1 - s.life * 0.7)) + 'px monospace';
                ctx.fillStyle = `rgba(255,255,255,${0.2 + (1 - s.life) * 0.8})`;
                ctx.fillText('7', s.x + (centerX-s.x)*s.life, s.y + (centerY-s.y)*s.life);
            });
            requestAnimationFrame(draw);
        }
        window.addEventListener('resize', resize); resize(); draw();
    </script>

    <script type="module">
        /* REPLACED ESM.SH WITH UNPKG (More CSP Friendly) */
        import * as THREE from 'https://unpkg.com/three@0.129.0/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.129.0/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.129.0/examples/jsm/loaders/GLTFLoader.js';
        import { RoomEnvironment } from 'https://unpkg.com/three@0.129.0/examples/jsm/environments/RoomEnvironment.js';

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2.6, 0, 2.6);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container3D').appendChild(renderer.domElement);

        const pmrem = new THREE.PMREMGenerator(renderer);
        scene.environment = pmrem.fromScene(new RoomEnvironment(), 0.02).texture;

        let object;
        new GLTFLoader().load('https://raw.githubusercontent.com/erocshgih/lightninghornunicorn/main/friendlyunicornminator.glb', (gltf) => {
            object = gltf.scene;
            scene.add(object);
        });

        const controls = new OrbitControls(camera, renderer.domElement);
        let isPlaying = false;
        const music = document.getElementById('background-music');

        document.getElementById('music-toggle').addEventListener('click', () => {
            isPlaying = !isPlaying;
            isPlaying ? music.play() : music.pause();
            document.getElementById('music-toggle').textContent = isPlaying ? "MUSIC ON" : "MUSIC OFF";
        });

        function animate() {
            requestAnimationFrame(animate);
            if (object) {
                object.rotation.y += 0.001;
                if (isPlaying) object.rotation.x = Math.sin(Date.now() * 0.01) * 0.1;
            }
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>